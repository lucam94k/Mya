<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">

  <!-- ‚úÖ VERSION UNICA (UGUALE IN TUTTE LE PAGINE DEL PROGETTO) -->
  <script>
    const VERSION = "4";
  </script>

  <link rel="manifest" href="manifest.json?v=4">
  <title>Folletto Tool - Attivit√†</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Anti-cache -->
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />

  <!-- ‚úÖ AUTO-FIX PRO: forza URL con ?v=VERSION + reload una volta in modalit√† app -->
  <script>
    (function () {
      const url = new URL(window.location.href);

      if (url.searchParams.get("v") !== VERSION) {
        url.searchParams.set("v", VERSION);
        window.location.replace(url.toString());
        return;
      }

      const isStandalone =
        (window.matchMedia && window.matchMedia("(display-mode: standalone)").matches) ||
        window.navigator.standalone === true;

      const reloadKey = "folletto_pwa_reload_v_" + VERSION;
      if (isStandalone && !sessionStorage.getItem(reloadKey)) {
        sessionStorage.setItem(reloadKey, "1");
        window.location.reload();
      }
    })();
  </script>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <style>
    :root{
      --green:#16a34a;
      --green2:#0f8a3c;
      --blue:#3b82c4;
      --blue2:#2f6fb0;
      --txt:#111827;
      --muted:#9ca3af;
      --line:#e5e7eb;
      --bg:#ffffff;
    }
    *{ box-sizing:border-box; -webkit-tap-highlight-color:transparent; }
    body{
      margin:0;
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Arial,sans-serif;
      background:var(--bg);
      color:var(--txt);
    }

    .topbar{
      height:60px;
      background:#fff;
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:0 14px;
    }
    .topbar .left, .topbar .right{
      display:flex;
      align-items:center;
      gap:16px;
      min-width:90px;
    }
    .topbar .title{
      font-size:26px;
      font-weight:900;
      color:#2f8acb;
      letter-spacing:.2px;
    }
    .iconBtn{
      border:0;
      background:transparent;
      padding:10px;
      font-size:22px;
      color:var(--green);
      cursor:pointer;
      border-radius:12px;
    }
    .iconBtn:active{ transform:scale(.98); }

    .greenLine{
      height:3px;
      background:var(--green);
      width:100%;
    }

    .datebar{
      height:66px;
      background:var(--blue);
      color:#fff;
      display:flex;
      align-items:center;
      justify-content:center;
      position:relative;
    }
    .datebar .arrow{
      position:absolute;
      top:50%;
      transform:translateY(-50%);
      border:0;
      background:transparent;
      color:#fff;
      font-size:22px;
      padding:14px;
      cursor:pointer;
      opacity:.95;
    }
    .datebar .arrow.left{ left:10px; }
    .datebar .arrow.right{ right:10px; }
    .datebar .dateText{
      font-weight:800;
      font-size:18px;
      letter-spacing:.2px;
    }

    .tabs{
      display:flex;
      align-items:flex-end;
      background:#fff;
      border-bottom:2px solid #d1d5db;
    }
    .tab{
      flex:1;
      text-align:center;
      padding:14px 10px 12px;
      font-weight:900;
      font-size:20px;
      color:#b0b7c3;
      position:relative;
      cursor:pointer;
    }
    .tab.active{ color:#111; }
    .tab.active::after{
      content:"";
      position:absolute;
      left:14%;
      right:14%;
      bottom:-2px;
      height:3px;
      background:#111;
      border-radius:2px;
    }

    .content{
      padding:14px;
      padding-bottom:170px;
      background:#fff;
    }

    .rowTop{
      display:flex;
      align-items:center;
      gap:12px;
      margin-top:6px;
      margin-bottom:12px;
    }
    .btnAddStreet{
      flex:1;
      height:52px;
      border:0;
      background:var(--green);
      color:#fff;
      font-weight:900;
      font-size:18px;
      border-radius:10px;
      cursor:pointer;
      box-shadow:0 8px 18px rgba(22,163,74,.16);
    }
    .btnClone{
      width:58px;
      height:52px;
      border-radius:10px;
      border:2px solid #cfe9d7;
      background:#fff;
      color:var(--green);
      font-size:22px;
      cursor:pointer;
      display:flex;
      align-items:center;
      justify-content:center;
    }
    .btnFilter{
      height:52px;
      min-width:118px;
      border-radius:12px;
      border:2px solid var(--green);
      background:#fff;
      color:var(--green);
      font-weight:900;
      font-size:18px;
      cursor:pointer;
      display:flex;
      align-items:center;
      justify-content:center;
      gap:10px;
    }

    .searchRow{
      display:flex;
      align-items:center;
      gap:12px;
    }
    .searchBox{
      flex:1;
      height:52px;
      border-radius:14px;
      border:2px solid #bfe5c9;
      background:#fff;
      display:flex;
      align-items:center;
      gap:10px;
      padding:0 14px;
      box-shadow:0 10px 18px rgba(0,0,0,.06);
    }
    .searchBox i{
      color:var(--green);
      font-size:18px;
    }
    .searchBox input{
      border:0;
      outline:none;
      width:100%;
      font-size:18px;
      background:transparent;
    }
    .btnPlus{
      width:52px;
      height:52px;
      border-radius:50%;
      border:0;
      background:var(--green);
      color:#fff;
      font-size:26px;
      font-weight:900;
      cursor:pointer;
      box-shadow:0 10px 18px rgba(22,163,74,.22);
    }
    .btnUp{
      width:40px;
      height:40px;
      border:0;
      background:transparent;
      color:var(--green);
      font-size:28px;
      cursor:pointer;
      transform: translateY(2px);
    }

    #listArea{
      margin-top:16px;
      min-height:280px;
    }

    .statsRow{
      position:fixed;
      left:0; right:0;
      bottom:70px;
      background:#fff;
      padding:12px 12px;
      display:flex;
      gap:12px;
      z-index:40;
      border-top:1px solid var(--line);
    }
    .statBox{
      flex:1;
      border:2px solid var(--green);
      border-radius:12px;
      padding:12px 10px;
      text-align:center;
      font-weight:900;
      color:var(--green);
      background:#fff;
      font-size:18px;
      box-shadow:0 8px 18px rgba(0,0,0,.04);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    .bottomBar{
      position:fixed;
      left:0; right:0;
      bottom:0;
      height:70px;
      background:var(--blue);
      display:flex;
      align-items:center;
      justify-content:space-around;
      padding:0 10px;
      z-index:50;
    }
    .bottomItem{
      display:flex;
      align-items:center;
      gap:8px;
      color:#fff;
      font-weight:900;
      opacity:.98;
      min-width:48px;
      justify-content:center;
    }
    .bottomItem i{ font-size:22px; }
    .bottomItem span{ font-size:18px; }

    .drawerOverlay{
      position:fixed; inset:0;
      background:rgba(0,0,0,.25);
      display:none;
      z-index:100;
    }
    .drawer{
      width:280px;
      height:100%;
      background:#fff;
      padding:16px;
      box-shadow:14px 0 40px rgba(0,0,0,.18);
    }
    .drawer h3{
      margin:8px 0 14px;
      font-size:18px;
      font-weight:900;
      color:#2f8acb;
    }
    .drawer .dBtn{
      width:100%;
      border:0;
      background:#111;
      color:#fff;
      font-weight:900;
      padding:14px 14px;
      border-radius:12px;
      cursor:pointer;
      margin-top:10px;
      font-size:16px;
    }

    @media(max-width:420px){
      .tab{ font-size:18px; }
      .btnFilter{ min-width:108px; font-size:17px; }
      .btnAddStreet{ font-size:17px; }
      .statBox{ font-size:16px; }
    }
  </style>
</head>

<body>

  <!-- Drawer -->
  <div class="drawerOverlay" id="drawerOverlay" onclick="closeDrawer(event)">
    <div class="drawer" onclick="event.stopPropagation()">
      <h3>Menu</h3>
      <button class="dBtn" type="button" onclick="goHome()">‚Üê Menu</button>
      <button class="dBtn" type="button" onclick="logout()">Disconnetti</button>
    </div>
  </div>

  <!-- TOP -->
  <div class="topbar">
    <div class="left">
      <button class="iconBtn" type="button" onclick="openDrawer()"><i class="fa fa-bars"></i></button>
    </div>
    <div class="title">Attivit√†</div>
    <div class="right">
      <button class="iconBtn" type="button" onclick="openReport()" title="Report">
        <i class="fa-regular fa-file-lines"></i>
      </button>
      <button class="iconBtn" type="button" onclick="openInfo()" title="Info">
        <i class="fa fa-circle-info"></i>
      </button>
    </div>
  </div>
  <div class="greenLine"></div>

  <!-- DATE BAR -->
  <div class="datebar">
    <button class="arrow left" type="button" onclick="shiftDay(-1)"><i class="fa fa-chevron-left"></i></button>
    <div class="dateText" id="dateText">--</div>
    <button class="arrow right" type="button" onclick="shiftDay(1)"><i class="fa fa-chevron-right"></i></button>
  </div>

  <!-- TABS -->
  <div class="tabs">
    <div class="tab active" id="tabAtt" onclick="setTab('att')">Le mie Attivit√†</div>
    <div class="tab" id="tabApp" onclick="setTab('app')">Appuntamenti</div>
  </div>

  <!-- CONTENT -->
  <div class="content">
    <div class="rowTop">
      <button class="btnAddStreet" type="button" onclick="addNewStreet()">Aggiungi nuova via</button>
      <button class="btnClone" type="button" onclick="duplicateDay()" title="Duplica">
        <i class="fa-regular fa-clone"></i>
      </button>
      <button class="btnFilter" type="button" onclick="openFilters()">
        <i class="fa fa-ellipsis-vertical"></i> Filtri
      </button>
    </div>

    <div class="searchRow">
      <div class="searchBox">
        <i class="fa fa-magnifying-glass"></i>
        <input id="streetInput" placeholder="Aggiungi nuova via" autocomplete="off">
      </div>
      <button class="btnPlus" type="button" onclick="quickAddStreet()">+</button>
      <button class="btnUp" type="button" onclick="collapseTop()" title="Comprimi">
        <i class="fa fa-angle-up"></i>
      </button>
    </div>

    <div id="listArea"></div>
  </div>

  <!-- STATS -->
  <div class="statsRow">
    <div class="statBox" id="statDemo">Demo: 0</div>
    <div class="statBox" id="statOrdini">Ordini: 0</div>
    <div class="statBox" id="statApp">Apparecchi: 0,00</div>
  </div>

  <!-- BOTTOM BAR -->
  <div class="bottomBar">
    <div class="bottomItem"><i class="fa-regular fa-hand-pointer"></i><span id="c1">0</span></div>
    <div class="bottomItem"><i class="fa-regular fa-bell"></i><span id="c2">0</span></div>
    <div class="bottomItem"><i class="fa-solid fa-diagram-project"></i><span id="c3">0</span></div>
    <div class="bottomItem"><i class="fa-solid fa-house"></i><span id="c4">0</span></div>
    <div class="bottomItem"><i class="fa-regular fa-square-check"></i><span id="c5">0</span></div>
    <div class="bottomItem"><i class="fa-solid fa-people-group"></i><span id="c6">0</span></div>
  </div>

  <script>
    // ‚úÖ Gate login
    if (localStorage.getItem("auth_ok") !== "1") {
      window.location.replace("index.html?v=" + VERSION);
    }

    function openDrawer(){ document.getElementById("drawerOverlay").style.display="block"; }
    function closeDrawer(){ document.getElementById("drawerOverlay").style.display="none"; }

    function goHome(){ window.location.href = "index.html?v=" + VERSION; }
    function logout(){
      localStorage.removeItem("auth_ok");
      window.location.href = "index.html?v=" + VERSION;
    }

    // Tabs (placeholder)
    function setTab(which){
      const a=document.getElementById("tabAtt");
      const p=document.getElementById("tabApp");
      if(which==="att"){ a.classList.add("active"); p.classList.remove("active"); }
      else { p.classList.add("active"); a.classList.remove("active"); }
    }

    // Date
    const mesi=["Gennaio","Febbraio","Marzo","Aprile","Maggio","Giugno","Luglio","Agosto","Settembre","Ottobre","Novembre","Dicembre"];
    const giorni=["Dom","Lun","Mar","Mer","Gio","Ven","Sab"];
    let current=new Date();

    function renderDate(){
      const g=giorni[current.getDay()];
      const d=String(current.getDate()).padStart(2,"0");
      const m=mesi[current.getMonth()];
      const y=current.getFullYear();
      document.getElementById("dateText").textContent = `${g} ${d} ${m} ${y}`;
    }
    function shiftDay(n){
      current.setDate(current.getDate()+n);
      renderDate();
    }
    renderDate();

    // Pulsanti (placeholder)
    function addNewStreet(){ document.getElementById("streetInput").focus(); }

    function quickAddStreet(){
      const v=document.getElementById("streetInput").value.trim();
      if(!v) return;

      const row=document.createElement("div");
      row.style.marginTop="12px";
      row.style.padding="12px 14px";
      row.style.border="1px solid #e5e7eb";
      row.style.borderRadius="12px";
      row.style.fontWeight="900";
      row.textContent = "üìç " + v;

      document.getElementById("listArea").prepend(row);
      document.getElementById("streetInput").value="";
    }

    function duplicateDay(){ alert("Duplica: lo attiviamo appena definisci la logica."); }
    function openFilters(){ alert("Filtri: lo attiviamo appena definisci gli stati/leggenda."); }
    function collapseTop(){ /* se vuoi lo faccio davvero */ }

    function openReport(){ alert("Report: dopo."); }
    function openInfo(){ alert("Info: dopo."); }
  </script>
</body>
</html>